<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Dialysis Clock</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f0f0f0;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 5px;
        cursor: pointer;
      }
      .test-button:hover {
        background: #45a049;
      }
      .test-result {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
        background: #e8f5e8;
        border-left: 4px solid #4caf50;
      }
      .test-error {
        background: #ffe8e8;
        border-left: 4px solid #f44336;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ Test de Dialysis Clock</h1>
      <p>
        Esta p√°gina permite probar la funcionalidad de la aplicaci√≥n sin afectar
        la configuraci√≥n real.
      </p>

      <h2>Pruebas de Funcionalidad</h2>

      <button class="test-button" onclick="testLocalStorage()">
        Probar localStorage
      </button>
      <button class="test-button" onclick="testDateLogic()">
        Probar l√≥gica de fechas
      </button>
      <button class="test-button" onclick="testConfigLoad()">
        Probar carga de configuraci√≥n
      </button>
      <button class="test-button" onclick="testStates()">Probar estados</button>
      <button class="test-button" onclick="testNightMode()">
        Probar modo noche
      </button>
      <button class="test-button" onclick="clearTestData()">
        Limpiar datos de prueba
      </button>

      <div id="test-results"></div>

      <h2>Simulador de Estados</h2>
      <p>Cambiar la fecha/hora del sistema para probar diferentes estados:</p>
      <ul>
        <li>
          <strong>Hoy di√°lisis:</strong> Martes, Jueves o S√°bado entre
          06:00-08:00
        </li>
        <li>
          <strong>Di√°lisis completada:</strong> Martes, Jueves o S√°bado despu√©s
          de 08:00
        </li>
        <li>
          <strong>Ma√±ana di√°lisis:</strong> Lunes, Mi√©rcoles o Viernes entre
          06:00-22:00
        </li>
        <li><strong>Descanso:</strong> Domingo entre 06:00-22:00</li>
        <li><strong>Modo noche:</strong> Cualquier d√≠a entre 22:00-06:00</li>
      </ul>

      <h2>Enlaces</h2>
      <p><a href="index.html" target="_blank">Abrir aplicaci√≥n principal</a></p>
      <p>
        <a href="config-example.json" target="_blank"
          >Ver configuraci√≥n de ejemplo</a
        >
      </p>
    </div>

    <script>
      function logTest(message, isError = false) {
        const results = document.getElementById("test-results");
        const div = document.createElement("div");
        div.className = isError ? "test-result test-error" : "test-result";
        div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
        results.appendChild(div);
      }

      function testLocalStorage() {
        try {
          const testKey = "dialysisClockTest";
          const testValue = JSON.stringify({
            test: true,
            timestamp: Date.now(),
          });

          localStorage.setItem(testKey, testValue);
          const retrieved = localStorage.getItem(testKey);
          const parsed = JSON.parse(retrieved);

          if (parsed.test) {
            localStorage.removeItem(testKey);
            logTest("‚úÖ localStorage funciona correctamente");
          } else {
            logTest("‚ùå Error en localStorage: datos no coinciden", true);
          }
        } catch (e) {
          logTest("‚ùå Error en localStorage: " + e.message, true);
        }
      }

      function testDateLogic() {
        try {
          const now = new Date();
          const day = now.getDay();
          const time = now.getHours() * 100 + now.getMinutes();

          logTest(`üìÖ Fecha actual: ${now.toLocaleDateString("es-ES")}`);
          logTest(`üìÖ D√≠a de la semana: ${day} (0=Domingo, 1=Lunes, etc.)`);
          logTest(`üïê Hora actual: ${now.toLocaleTimeString("es-ES")}`);
          logTest(`üïê Tiempo num√©rico: ${time}`);

          // Probar l√≥gica de modo noche
          const nightStart = 2200; // 22:00
          const nightEnd = 600; // 06:00
          const isNight = time >= nightStart || time < nightEnd;
          logTest(`üåô Modo noche: ${isNight ? "S√ç" : "NO"}`);
        } catch (e) {
          logTest("‚ùå Error en l√≥gica de fechas: " + e.message, true);
        }
      }

      function testConfigLoad() {
        try {
          const defaultConfig = {
            dialysisDays: [2, 4, 6],
            ambulanceTime: "06:30",
            dialysisEndTime: "08:00",
            nightStart: "22:00",
            nightEnd: "06:00",
            colors: {
              today: "#4CAF50",
              completed: "#2E7D32",
              tomorrow: "#FF9800",
              rest: "#2196F3",
              night: "#673AB7",
            },
            showTime: true,
          };

          // Simular carga de configuraci√≥n
          const saved = localStorage.getItem("dialysisClockConfig");
          let config = defaultConfig;

          if (saved) {
            config = Object.assign(defaultConfig, JSON.parse(saved));
          }

          logTest("‚úÖ Configuraci√≥n cargada correctamente");
          logTest(`üìã D√≠as de di√°lisis: ${config.dialysisDays.join(", ")}`);
          logTest(`üöë Hora ambulancia: ${config.ambulanceTime}`);
          logTest(`üåô Modo noche: ${config.nightStart} - ${config.nightEnd}`);
        } catch (e) {
          logTest("‚ùå Error cargando configuraci√≥n: " + e.message, true);
        }
      }

      function testStates() {
        try {
          const now = new Date();
          const currentDay = now.getDay();
          const currentTime = now.getHours() * 100 + now.getMinutes();
          const dialysisDays = [2, 4, 6]; // Martes, Jueves, S√°bado
          const dialysisEndTime = 800; // 08:00

          let state = "unknown";
          let message = "";

          // Verificar si hoy es d√≠a de di√°lisis
          if (dialysisDays.includes(currentDay)) {
            if (currentTime >= dialysisEndTime) {
              state = "completed";
              message = "YA FUE A DI√ÅLISIS";
            } else {
              state = "today";
              message = "HOY HAY DI√ÅLISIS";
            }
          } else {
            // Verificar si ma√±ana es d√≠a de di√°lisis
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowDay = tomorrow.getDay();

            if (dialysisDays.includes(tomorrowDay)) {
              state = "tomorrow";
              message = "MA√ëANA HAY DI√ÅLISIS";
            } else {
              state = "rest";
              message = "HOY DESCANSO";
            }
          }

          logTest(`üéØ Estado detectado: ${state}`);
          logTest(`üí¨ Mensaje: ${message}`);
        } catch (e) {
          logTest("‚ùå Error probando estados: " + e.message, true);
        }
      }

      function testNightMode() {
        try {
          const now = new Date();
          const currentTime = now.getHours() * 100 + now.getMinutes();
          const nightStart = 2200; // 22:00
          const nightEnd = 600; // 06:00

          const isNight = currentTime >= nightStart || currentTime < nightEnd;

          if (isNight) {
            // Simular l√≥gica de modo noche
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowDay = tomorrow.getDay();
            const dialysisDays = [2, 4, 6];

            if (dialysisDays.includes(tomorrowDay)) {
              logTest(
                'üåô Modo noche: Ma√±ana hay di√°lisis - "Duerme tranquilo"'
              );
            } else {
              logTest('üåô Modo noche: Ma√±ana no hay di√°lisis - "Descansa"');
            }
          } else {
            logTest("‚òÄÔ∏è Modo diurno activo");
          }
        } catch (e) {
          logTest("‚ùå Error probando modo noche: " + e.message, true);
        }
      }

      function clearTestData() {
        try {
          // Limpiar solo datos de prueba, no la configuraci√≥n real
          const keys = Object.keys(localStorage);
          keys.forEach((key) => {
            if (key.includes("Test") || key.includes("test")) {
              localStorage.removeItem(key);
            }
          });

          logTest("üßπ Datos de prueba limpiados");
        } catch (e) {
          logTest("‚ùå Error limpiando datos: " + e.message, true);
        }
      }

      // Ejecutar pruebas autom√°ticas al cargar
      window.addEventListener("load", function () {
        logTest("üöÄ Iniciando pruebas autom√°ticas...");
        setTimeout(() => testLocalStorage(), 100);
        setTimeout(() => testDateLogic(), 200);
        setTimeout(() => testConfigLoad(), 300);
        setTimeout(() => testStates(), 400);
        setTimeout(() => testNightMode(), 500);
      });
    </script>
  </body>
</html>
